{
  "version": "1.0",
  "lessons": [
    {
      "id": "umask-intro",
      "command": "umask",
      "code": "umask",
      "title": "Understanding Default Permissions",
      "tags": ["permissions", "advanced", "security"],
      "level": "advanced",
      "module": "permissions",
      "about": {
        "what": "The `umask` command sets **default permissions** for newly created files and directories. It's a **mask** that subtracts permissions from the system defaults.\n\n**System defaults (before umask):**\n- Files: 666 (rw-rw-rw-)\n- Directories: 777 (rwxrwxrwx)\n\n**Common umask values:**\n- **022** - Removes write from group/others\n  - Files: 644 (rw-r--r--)\n  - Dirs: 755 (rwxr-xr-x)\n- **002** - Removes write from others only  \n  - Files: 664 (rw-rw-r--)\n  - Dirs: 775 (rwxrwxr-x)\n- **077** - Removes all permissions from group/others\n  - Files: 600 (rw-------)\n  - Dirs: 700 (rwx------)\n\n**How it works:**\numask is a **subtraction mask** in octal:\n```\nDefault: 666 (files) or 777 (directories)\numask:   022\nResult:  644 (files) or 755 (directories)\n```",
        "history": "`umask` was introduced in early Unix (1970s) to solve a critical problem: **what permissions should new files have by default?**\n\nThe challenge:\n- Making files world-writable (666) by default was dangerous\n- Making files private (600) by default prevented collaboration\n- Different users needed different defaults\n- Hardcoding defaults in each program was impractical\n\nDennis Ritchie and Ken Thompson designed `umask` as an elegant solution: a **per-user, per-session** setting that automatically applied to all file creation.\n\nThe name 'umask' comes from \"user file creation mask\" - it masks (blocks) certain permission bits from being set.\n\n**Why a subtraction mask?**\nIt might seem backwards (why subtract instead of specify directly?), but there's wisdom:\n- Programs can request maximum permissions (666/777)\n- umask ensures security by removing unsafe permissions\n- User controls security policy, not each application\n- Same mechanism works for all file creation\n\n**Historical defaults:**\n- **1970s-1980s**: umask 022 became standard for personal Unix systems\n- **1990s-2000s**: Some shared systems used umask 002 for collaboration\n- **Modern**: Debian/Ubuntu default to 022, RHEL to 022, BSD to 022\n\n**The umask 077 security trend:**\nIn the 2010s, security-conscious users started using umask 077 by default:\n- Files private by default (600)\n- Explicitly share when needed\n- \"Secure by default\" philosophy\n- Common in financial and government environments\n\nToday, umask is set in shell config files (.bashrc, .zshrc) and affects every file you create in that shell session.",
        "example": "```bash\n# View current umask\numask\n# Output: 0022\n\n# View in symbolic notation\numask -S\n# Output: u=rwx,g=rx,o=rx\n\n# Set umask to 022 (standard)\numask 022\ntouch file.txt\nls -l file.txt\n# -rw-r--r-- (644)\n\n# Set umask to 077 (private)\numask 077\ntouch private.txt\nls -l private.txt\n# -rw------- (600)\n\n# Set umask to 002 (group collaboration)\numask 002\ntouch shared.txt\nls -l shared.txt\n# -rw-rw-r-- (664)\n\n# Permanent umask (add to ~/.bashrc or ~/.zshrc)\necho 'umask 022' >> ~/.bashrc\n```",
        "commonUses": [
          "**Security hardening** - Set umask 077 for private-by-default files",
          "**Team collaboration** - Set umask 002 for group-writable files",
          "**Standard personal use** - umask 022 for readable but protected files",
          "**Script environments** - Set umask in scripts for consistent permissions",
          "**Server configuration** - Set umask in service files for proper file creation"
        ]
      },
      "hints": [
        "Run 'umask' to see the current umask value",
        "Read the explanation file to understand how umask works",
        "The completion code is in the guide file"
      ],
      "sandbox": {
        "startDir": "workspace",
        "dirs": ["workspace"],
        "files": {
          "workspace/task.txt": "Task: Understand umask and default file permissions\n\n1. Check current umask: umask\n2. Create a test file: touch testfile.txt\n3. Check its permissions: ls -l testfile.txt\n4. Read the explanation: cat umask-explained.txt\n5. Read the guide: cat umask-guide.txt\n6. Find the completion code\n\nNote: umask affects NEW files only, not existing ones.",
          "workspace/umask-explained.txt": "Understanding umask\n===================\n\numask is a **subtraction mask** that controls default permissions.\n\nSystem Defaults (before umask):\n  Files:       666 (rw-rw-rw-)\n  Directories: 777 (rwxrwxrwx)\n\numask Subtraction:\n  If umask is 022:\n  \n  For files:\n    Default: 666 (rw-rw-rw-)\n    umask:   022 (----w--w-)\n    Result:  644 (rw-r--r--)\n    \n  For directories:\n    Default: 777 (rwxrwxrwx)\n    umask:   022 (----w--w-)\n    Result:  755 (rwxr-xr-x)\n\nHow to calculate:\n  1. Start with default (666 files, 777 directories)\n  2. Subtract each umask digit\n  3. Result is the permission for new files\n\nCommon umask values:\n\n  umask 022 (standard):\n    Files: 644 (rw-r--r--) \n    Dirs:  755 (rwxr-xr-x)\n    Use: Personal systems, most users\n    \n  umask 002 (group collaboration):\n    Files: 664 (rw-rw-r--)\n    Dirs:  775 (rwxrwxr-x)\n    Use: Shared project directories\n    \n  umask 077 (private):\n    Files: 600 (rw-------)\n    Dirs:  700 (rwx------)\n    Use: Security-sensitive environments\n    \n  umask 000 (dangerous!):\n    Files: 666 (rw-rw-rw-)\n    Dirs:  777 (rwxrwxrwx)\n    Use: Almost never (security risk)\n\nSee umask-guide.txt for practical examples.",
          "workspace/umask-guide.txt": "umask Practical Guide\n=====================\n\nCommands:\n---------\n\n# View current umask (octal)\numask\n# Output: 0022\n\n# View current umask (symbolic)\numask -S  \n# Output: u=rwx,g=rx,o=rx\n\n# Set umask temporarily (current shell only)\numask 022\numask 002  \numask 077\n\n# Set umask permanently (add to ~/.bashrc or ~/.zshrc)\necho 'umask 022' >> ~/.bashrc\nsource ~/.bashrc\n\nTesting umask:\n--------------\n\n# Test with umask 022\numask 022\ntouch file1.txt\nmkdir dir1\nls -l\n# file1.txt: -rw-r--r-- (644)\n# dir1:      drwxr-xr-x (755)\n\n# Test with umask 077\numask 077\ntouch file2.txt\nmkdir dir2\nls -l\n# file2.txt: -rw------- (600)\n# dir2:      drwx------ (700)\n\n# Test with umask 002\numask 002\ntouch file3.txt\nmkdir dir3\nls -l\n# file3.txt: -rw-rw-r-- (664)\n# dir3:      drwxrwxr-x (775)\n\nUse Cases:\n----------\n\n1. Personal workstation (umask 022):\n   - Files readable by others: good for sharing\n   - Only you can write: protected from accidents\n   - Standard for most users\n   \n2. Team project directory (umask 002):\n   - Group members can write: collaboration\n   - Others can read: transparency\n   - Good with group ownership\n   \n3. Security-sensitive (umask 077):\n   - Only you can access files\n   - Maximum privacy\n   - Required for:\n     * SSH keys (umask 077; chmod 600 ~/.ssh/id_rsa)\n     * Credentials files\n     * Personal data\n     \n4. Web server (umask 022):\n   - Files readable by web server\n   - Protected from modification\n   - Standard for serving static content\n\nCommon Mistakes:\n----------------\n\n❌ umask 000 (world-writable)\n   - Dangerous: anyone can modify your files\n   - Security risk\n   - Almost never correct\n   \n❌ Forgetting umask only affects NEW files\n   - Changing umask doesn't change existing files\n   - Use chmod to fix existing permissions\n   \n❌ Setting umask in wrong file\n   - Set in shell RC file (~/.bashrc, ~/.zshrc)\n   - Not in ~/.profile (may not be sourced)\n   \n✅ Match umask to use case\n✅ Test with touch/mkdir before bulk operations  \n✅ Document umask in project READMEs\n✅ Use umask in scripts for consistent permissions\n\nScript Usage:\n-------------\n\n#!/bin/bash\n# Set strict umask for secure file creation\numask 077\n\n# Create sensitive files (will be 600)\necho 'secret' > credentials.txt\nmkdir private-data\n\n# Files automatically private!\n# credentials.txt: -rw-------\n# private-data:    drwx------\n\nRelationship to chmod/chown:\n-----------------------------\n\numask:  Sets DEFAULT permissions for NEW files\nchmod:  Changes permissions on EXISTING files  \nchown:  Changes ownership on EXISTING files\n\nWorkflow:\n  1. Set umask for your desired defaults\n  2. Create files (get correct permissions automatically)\n  3. Use chmod if you need to adjust specific files\n  4. Use chown if you need to change ownership\n\n================================================\nCOMPLETION CODE: UMASK-DEFAULT-PERMISSIONS\n================================================\n\nKey Takeaway:\n  umask controls default permissions for NEW files.\n  It's a subtraction mask applied during file creation.\n  Set it once, all new files get correct permissions!\n  \nCommon values:\n  022 - Standard (644 files, 755 dirs)\n  002 - Team collaboration (664 files, 775 dirs)\n  077 - Private (600 files, 700 dirs)"
        }
      },
      "instructions": "## Your Task\n\nLearn how umask controls default permissions for newly created files.\n\n**Steps:**\n1. Read the task: `cat task.txt`\n2. Check current umask: `umask`\n3. Create a test file: `touch testfile.txt`\n4. Check its permissions: `ls -l testfile.txt`\n5. Read the explanation: `cat umask-explained.txt`\n6. Read the guide: `cat umask-guide.txt`\n7. Find and copy the completion code\n8. Type `exit` and paste the code\n\n**Learn:** umask is a subtraction mask that sets default permissions. Common values: 022 (standard), 002 (collaboration), 077 (private).",
      "requirements": [
        {
          "type": "command_output",
          "description": "The completion code from the umask guide",
          "validator": "exact",
          "expected": "UMASK-DEFAULT-PERMISSIONS"
        }
      ]
    },
    {
      "id": "umask-practical",
      "command": "umask",
      "code": "umask 077",
      "title": "Secure File Creation with umask",
      "tags": ["permissions", "advanced", "security", "best-practices"],
      "level": "advanced",
      "module": "permissions",
      "about": {
        "what": "Setting `umask 077` creates **private-by-default** files - only the owner can access them.\n\n**The security principle:**\n- Start with maximum privacy\n- Explicitly share when needed\n- Prevents accidental information disclosure\n- Required for sensitive files\n\n**When to use umask 077:**\n- SSH private keys\n- Credentials and passwords\n- Personal documents\n- Financial data\n- Security-sensitive scripts\n\n**Result of umask 077:**\n```bash\numask 077\ntouch file.txt\nls -l file.txt\n# -rw------- (600) - only owner can read/write\n\nmkdir dir\nls -ld dir\n# drwx------ (700) - only owner can access\n```\n\n**Why this matters:**\nMany security breaches happen because files have overly permissive defaults. umask 077 prevents this by making files private first.",
        "history": "The use of `umask 077` for security-sensitive files emerged from hard-learned lessons in the Unix community.\n\n**Early Unix (1970s-1980s):**\nMost systems used umask 022, making files world-readable by default. This was fine for:\n- Academic environments (open sharing)\n- Small teams (everyone trusted)\n- Single-user workstations\n\nBut it caused problems:\n- Users accidentally created readable password files\n- Private keys were exposed\n- Personal files leaked to other users\n\n**The SSH wake-up call (1990s):**\nWhen SSH became popular in the mid-1990s, a common mistake emerged:\n```bash\n# Wrong - private key readable by others!\ncp id_rsa ~/.ssh/id_rsa\nls -l ~/.ssh/id_rsa\n# -rw-r--r-- 1 user group 1679 Dec 31 id_rsa\n```\n\nSSH refused to use keys with wrong permissions (security feature). This taught users about permission security, but through pain.\n\n**Security standards (2000s-present):**\nSecurity frameworks began requiring umask 077 for:\n- PCI-DSS (credit card data): Private-by-default files\n- HIPAA (healthcare): Protect patient information\n- Government/military: Classified data handling\n- Financial services: Protect transaction data\n\n**Modern best practices:**\nMany organizations now mandate:\n```bash\n# In ~/.bashrc or ~/.zshrc\numask 077\n```\n\nThis makes files private by default. If you need to share:\n```bash\n# Explicitly make readable\nchmod 644 public-file.txt\n```\n\n**The principle: Secure by default**\n- It's easy to relax permissions (chmod 644)\n- It's hard to find files with wrong permissions\n- Default to private, share intentionally\n- Prevents accidental exposure\n\nToday, cloud services and containers often use umask 077 by default for security.",
        "example": "```bash\n# Set strict umask\numask 077\n\n# Create SSH private key (automatically 600)\nssh-keygen -t ed25519\nls -l ~/.ssh/id_ed25519\n# -rw------- (600) ✓ Correct\n\n# Create credentials file (automatically 600)\necho 'PASSWORD=secret123' > .env\nls -l .env\n# -rw------- (600) ✓ Secure\n\n# Create script with secrets (automatically 700)\nmkdir ~/scripts\ncat > ~/scripts/backup.sh << 'EOF'\n#!/bin/bash\nBACKUP_KEY=\"secret-key\"\nEOF\nchmod +x ~/scripts/backup.sh\nls -l ~/scripts/backup.sh\n# -rwx------ (700) ✓ Private executable\n\n# If you need to share a file, explicitly make it readable\ntouch README.md\nchmod 644 README.md\nls -l README.md\n# -rw-r--r-- (644) ✓ Intentionally public\n\n# Permanent secure umask (add to ~/.bashrc)\necho 'umask 077' >> ~/.bashrc\n```",
        "commonUses": [
          "**SSH key generation** - Private keys must be 600 (umask 077 ensures this)",
          "**Credential files** - .env files, password files, API keys",
          "**Personal scripts** - Scripts containing sensitive data or logic",
          "**Configuration files** - Files with passwords or secrets",
          "**Security-focused environments** - Financial, healthcare, government systems"
        ]
      },
      "hints": [
        "Set umask to 077 to make files private by default",
        "Create a file and check if it has 600 permissions",
        "Read the scenario to understand why this matters"
      ],
      "sandbox": {
        "startDir": "workspace",
        "dirs": ["workspace"],
        "files": {
          "workspace/scenario.txt": "Security Scenario: SSH Key Exposure\n====================================\n\nThe Incident:\n-------------\n\nDeveloper Alice is setting up SSH keys:\n\n  $ ssh-keygen -t ed25519\n  Generating public/private ed25519 key pair.\n  Enter file: /home/alice/.ssh/id_ed25519\n  (Created with default umask 022)\n  \n  $ ls -l ~/.ssh/\n  -rw-r--r-- 1 alice alice 1679 Dec 31 id_ed25519      # PRIVATE KEY!\n  -rw-r--r-- 1 alice alice  400 Dec 31 id_ed25519.pub  # Public key (OK)\n\nThe Problem:\n------------\n\nPrivate key is WORLD-READABLE!\n  - Other users can read: cat /home/alice/.ssh/id_ed25519\n  - Attacker can steal the key\n  - Attacker can impersonate Alice\n  - Attacker can access all servers Alice has access to\n\nSSH Protection:\n---------------\n\nSSH actually checks permissions and refuses:\n\n  $ ssh server.com\n  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n  @         WARNING: UNPROTECTED PRIVATE KEY FILE!          @\n  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n  Permissions 0644 for '/home/alice/.ssh/id_ed25519' are too open.\n  It is required that your private key files are NOT accessible by others.\n  This private key will be IGNORED.\n\nThe Fix:\n--------\n\nOption 1: Fix permissions manually (reactive)\n  chmod 600 ~/.ssh/id_ed25519\n  \nOption 2: Set umask before creating files (proactive)\n  umask 077\n  ssh-keygen -t ed25519\n  # Key is automatically 600!\n  \nOption 3: Set umask permanently (best)\n  echo 'umask 077' >> ~/.bashrc\n  source ~/.bashrc\n  # All future files are private by default\n\nSee security-guide.txt for more details.",
          "workspace/security-guide.txt": "Secure File Creation Guide\n===========================\n\nThe Problem:\n------------\n\nDefault umask (022) makes files world-readable:\n  - Anyone can read your files\n  - Secrets accidentally exposed  \n  - Private data leaked\n  - Security vulnerabilities\n\nThe Solution:\n-------------\n\nSet umask 077 for private-by-default files:\n\n  # Temporary (current shell)\n  umask 077\n  \n  # Permanent (add to ~/.bashrc or ~/.zshrc)\n  echo 'umask 077' >> ~/.bashrc\n  source ~/.bashrc\n\nWhat This Does:\n---------------\n\nNew files are created with 600 permissions:\n  -rw------- (owner: read/write, group: none, others: none)\n  \nNew directories are created with 700 permissions:\n  drwx------ (owner: rwx, group: none, others: none)\n\nOnly YOU can access your files by default.\n\nFiles That REQUIRE Strict Permissions:\n--------------------------------------\n\n1. SSH private keys:\n   Required: 600 or 400\n   umask 077 ensures this\n   \n2. GPG private keys:\n   Required: 600\n   chmod 600 ~/.gnupg/*.key\n   \n3. Credential files:\n   .env files, API keys, passwords\n   Should be: 600\n   \n4. SSL/TLS private keys:\n   Web server keys, certificate keys\n   Must be: 600 or 400\n   \n5. Database credentials:\n   Config files with passwords\n   Should be: 600\n\nWorkflow with umask 077:\n------------------------\n\n# Set secure umask\numask 077\n\n# Create files (automatically private)\necho 'API_KEY=secret' > .env\nssh-keygen -t ed25519\nmkdir ~/private-docs\n\n# All created with minimal permissions!\nls -l .env\n# -rw------- (600) ✓\n\nls -l ~/.ssh/id_ed25519  \n# -rw------- (600) ✓\n\nls -ld ~/private-docs\n# drwx------ (700) ✓\n\n# If you need to share a file, explicitly do so:\ntouch public-file.txt\nchmod 644 public-file.txt\n# Now: -rw-r--r-- (intentionally public)\n\nSecurity Principles:\n--------------------\n\n1. **Secure by default**\n   Start private, share intentionally\n   \n2. **Least privilege**\n   Minimum permissions necessary\n   \n3. **Defense in depth**\n   Multiple layers of security\n   \n4. **Fail secure**\n   If unsure, be more restrictive\n\nReal-World Example:\n-------------------\n\nDevelopment workflow:\n\n  # Set strict umask\n  umask 077\n  \n  # Generate SSH key (private)\n  ssh-keygen -t ed25519\n  # Automatically 600 - secure!\n  \n  # Create API credentials (private)\n  cat > ~/.aws/credentials << 'EOF'\n  [default]\n  aws_access_key_id = AKIA...\n  aws_secret_access_key = secret...\n  EOF\n  # Automatically 600 - secure!\n  \n  # Public files need explicit permission\n  echo '# My Project' > README.md\n  chmod 644 README.md\n  # Now: -rw-r--r-- - intentionally public\n  \n  # Scripts that should be executable\n  cat > deploy.sh << 'EOF'\n  #!/bin/bash\n  echo \"Deploying...\"\n  EOF\n  chmod 700 deploy.sh\n  # Now: -rwx------ - owner-only executable\n\nCompliance:\n-----------\n\nMany standards REQUIRE umask 077:\n\n- PCI-DSS (payment cards)\n- HIPAA (healthcare)  \n- SOX (financial)\n- Government/military\n- ISO 27001 (information security)\n\nBest Practices:\n---------------\n\n✅ Set umask 077 in shell RC files\n✅ Use 600 for all credential files\n✅ Use 400 for read-only secrets (even more restrictive)\n✅ Explicitly chmod 644 for public files\n✅ Never use 777 (world-writable)\n✅ Audit permissions regularly\n\n❌ Don't use umask 000 (dangerous)\n❌ Don't leave credentials as 644 (readable)\n❌ Don't assume default permissions are safe\n❌ Don't copy permissions blindly\n\nTesting Your Setup:\n-------------------\n\n# Check current umask\numask\n# Should show: 0077\n\n# Test file creation\ntouch testfile\nls -l testfile\n# Should show: -rw-------\n\n# Test directory creation  \nmkdir testdir\nls -ld testdir\n# Should show: drwx------\n\n# If correct, you're secure by default!\n\n================================================\nCOMPLETION CODE: UMASK-SECURE-BY-DEFAULT\n================================================\n\nRemember:\n  umask 077 = private by default\n  Share intentionally with chmod\n  Protects credentials, keys, and sensitive data\n  Required for security compliance\n  \nMake it permanent:\n  echo 'umask 077' >> ~/.bashrc",
          "workspace/task.txt": "Task: Learn about secure file creation with umask 077\n\n1. Read the scenario: cat scenario.txt\n2. Understand the security risk\n3. Read the guide: cat security-guide.txt\n4. Find the completion code\n\nSecurity principle:\n  Private by default - share intentionally\n  umask 077 ensures files are created with minimal permissions"
        }
      },
      "instructions": "## Your Task\n\nLearn how umask 077 creates secure, private-by-default files.\n\n**Steps:**\n1. Read the task: `cat task.txt`\n2. Read the scenario: `cat scenario.txt` (understand the security risk)\n3. Read the security guide: `cat security-guide.txt` (learn the solution)\n4. Find and copy the completion code\n5. Type `exit` and paste the code\n\n**Learn:** umask 077 makes files private by default (600/700). This prevents accidental exposure of credentials, keys, and sensitive data. Share intentionally with chmod.",
      "requirements": [
        {
          "type": "command_output",
          "description": "The completion code from the security guide",
          "validator": "exact",
          "expected": "UMASK-SECURE-BY-DEFAULT"
        }
      ]
    }
  ]
}
